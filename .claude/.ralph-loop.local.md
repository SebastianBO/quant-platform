# Ralph Loop State

## Prompt
Expand lician.com to have **ALL** public company financial data - US AND Europe. Enable users to analyze ANY public company's financials through the AI chat.

### Core Mission
1. **US Companies**: Populate empty `financial_metrics` table (PE ratio, market cap, margins)
2. **ALL European Companies**: Sweden, Norway, Denmark, Finland, Germany, UK, France, Netherlands, etc.
3. Enable AI chat to answer questions about ANY public company worldwide

### Data Sources Strategy

**US (5,344 companies already have financials):**
- Yahoo Finance (FREE) - PE ratio, market cap, EPS, dividend yield
- Calculate metrics from existing SEC EDGAR data in Supabase

**Sweden:**
- Allabolag.se (FREE scraping) - Swedish company registry + financials

**Norway:**
- Brreg (FREE - No API key!) - Company registry
- Regnskapsregisteret (FREE!) - Full income statements & balance sheets

**UK:**
- Companies House (FREE API) - 4.5+ million companies
- Companies House Bulk Data (FREE XBRL download) - Full financial statements

**Denmark:** CVR Register API
**Finland:** PRH API
**Germany:** Bundesanzeiger

### Database Schema
- `eu_companies` - Master company table for all EU countries
- `eu_income_statements` - IFRS format income statements
- `eu_balance_sheets` - IFRS format balance sheets
- `eu_cash_flow_statements` - IFRS format cash flows
- `eu_financial_metrics` - Calculated metrics
- `eu_sync_log` - Sync tracking

### Success Criteria
- financial_metrics has PE/market cap for 1000+ US companies
- Database has 50,000+ European companies
- AI chat can answer: "What is Volvo's revenue?" or "Compare H&M to Zara"

## Config
- max_iterations: 50
- completion_promise: EU FINANCIAL DATA COMPLETE
- current_iteration: 2
- started_at: 2026-01-08T09:45:00Z

## Progress Log

### Iteration 1 - COMPLETE
Built core infrastructure:
- US financial_metrics sync from Yahoo Finance
- EU database schema (IFRS format)
- Swedish companies scraper (Allabolag.se)
- UK companies sync (Companies House API)
- Norwegian companies sync (Brreg API - FREE!)

### Iteration 2 - COMPLETE
**Added Full Financial Statements:**

1. **Norwegian Financials** (`/api/cron/sync-norwegian-financials`)
   - Uses Regnskapsregisteret API (FREE, no key!)
   - Full income statements & balance sheets
   - Revenue, profit, assets, equity, liabilities
   - Pre-loaded 15 major Norwegian companies

2. **UK Financials** (`/api/cron/sync-uk-financials`)
   - Uses Companies House Filing History API
   - Bulk XBRL data available for download
   - Links to FREE daily/monthly accounts data

3. **AI Tools for EU Companies** (Added to `src/lib/ai/tools.ts`)
   - `searchEUCompanies` - Search by name or country
   - `getEUCompanyDetails` - Full company profile
   - `getEUFinancialStatements` - Income statements & balance sheets
   - `compareEUCompanies` - Compare Volvo vs BMW, H&M vs Zara

**New Files Created:**
- `src/app/api/cron/sync-norwegian-financials/route.ts`
- `src/app/api/cron/sync-uk-financials/route.ts`

### Iteration 3 - NEXT
- Deploy migrations to Supabase
- Run initial data sync for major companies
- Test AI chat with EU company queries
- Add Danish (CVR) and Finnish (PRH) integrations

## API Keys Needed
- **UK Companies House**: FREE from https://developer.company-information.service.gov.uk/
- **Others**: All FREE, no keys required!

## FREE Data Sources Summary
| Country | Source | API Key | Full Financials |
|---------|--------|---------|-----------------|
| Sweden | Allabolag.se | No (scraping) | Yes |
| Norway | Brreg + Regnskapsregisteret | **No** | Yes |
| UK | Companies House | Yes (free) | Yes (bulk XBRL) |

## Status
ACTIVE - Iteration 2 Complete, AI Tools Ready
