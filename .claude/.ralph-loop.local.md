# Ralph Loop State

## Prompt
Expand lician.com to have **ALL** public company financial data - US AND Europe. Enable users to analyze ANY public company's financials through the AI chat.

### Core Mission
1. **US Companies**: Populate empty `financial_metrics` table (PE ratio, market cap, margins)
2. **ALL European Companies**: Sweden, Norway, Denmark, Finland, Germany, UK, France, Netherlands, etc.
3. Enable AI chat to answer questions about ANY public company worldwide

### Data Sources Strategy

**US (5,344 companies already have financials):**
- Yahoo Finance (FREE) - PE ratio, market cap, EPS, dividend yield
- Calculate metrics from existing SEC EDGAR data in Supabase

**Sweden:**
- Allabolag.se (FREE) - Swedish company registry + financials
- Nasdaq Stockholm - Traded companies
- Finansinspektionen - Regulatory filings

**Norway:**
- Brreg (FREE - No API key!) - Official Norwegian business registry
- Oslo Børs - Listed companies

**Denmark:**
- Nasdaq Copenhagen
- CVR Register - Danish company data

**Finland:**
- Nasdaq Helsinki
- PRH (Finnish Patent and Registration Office)

**Germany:**
- XETRA (Deutsche Börse) - Listed companies
- Bundesanzeiger - Annual reports

**UK:**
- Companies House (FREE API) - All UK companies (4+ million)
- LSE - Listed companies

**France/Netherlands/etc:**
- Euronext - Listed companies
- National company registries

### Database Schema
- Created `eu_companies`, `eu_income_statements`, `eu_balance_sheets`, `eu_cash_flow_statements`, `eu_financial_metrics`
- Full IFRS support (different from US-GAAP)
- Stores exchange info (OMX, OSE, LSE, XETRA, etc.)

### Success Criteria
- financial_metrics has PE/market cap for 1000+ US companies
- Database has 50,000+ European companies
- AI chat can answer: "What is Volvo's revenue?" or "Compare H&M to Zara"

## Config
- max_iterations: 50
- completion_promise: EU FINANCIAL DATA COMPLETE
- current_iteration: 1
- started_at: 2026-01-08T09:45:00Z

## Progress Log

### Iteration 1 - COMPLETE
**Infrastructure Built:**

1. **US Financial Metrics Sync** (`/api/cron/sync-financial-metrics`)
   - Fetches PE ratio, market cap, margins from Yahoo Finance
   - Targets all 5,344 companies with SEC financial data
   - Rate limited: 2 requests/second

2. **Database Schema** (`20260108000002_eu_companies_schema.sql`)
   - `eu_companies` - Master company table for all EU countries
   - `eu_income_statements` - IFRS format income statements
   - `eu_balance_sheets` - IFRS format balance sheets
   - `eu_cash_flow_statements` - IFRS format cash flows
   - `eu_financial_metrics` - Calculated metrics
   - `eu_sync_log` - Sync tracking

3. **Swedish Companies Sync** (`/api/cron/sync-swedish-companies`)
   - Scrapes Allabolag.se for company data
   - Pre-loaded 30+ major Swedish companies (Volvo, Ericsson, H&M, etc.)
   - Supports search by name and top companies by revenue

4. **UK Companies Sync** (`/api/cron/sync-uk-companies`)
   - Uses FREE Companies House API
   - Access to 4.5+ million UK companies
   - Pre-loaded 40+ FTSE 100 companies
   - Requires API key from developer.company-information.service.gov.uk

5. **Norwegian Companies Sync** (`/api/cron/sync-norwegian-companies`)
   - Uses FREE Brreg API (No API key required!)
   - Access to 1.1+ million Norwegian companies
   - Pre-loaded 30+ major companies (Equinor, DNB, Telenor, etc.)
   - Supports search by org form (AS, ASA)

**Files Created:**
- `src/app/api/cron/sync-financial-metrics/route.ts`
- `src/app/api/cron/sync-swedish-companies/route.ts`
- `src/app/api/cron/sync-uk-companies/route.ts`
- `src/app/api/cron/sync-norwegian-companies/route.ts`
- `supabase/migrations/20260108000001_add_financial_metrics_ticker_constraint.sql`
- `supabase/migrations/20260108000002_eu_companies_schema.sql`

### Iteration 2 - NEXT
- Deploy and test the new cron jobs
- Run initial sync for major companies
- Add AI tools for EU company queries
- Build Danish (CVR) and Finnish (PRH) integrations

## Ideas Queue
1. ✅ Allabolag.se scraper for Swedish companies
2. ✅ Companies House API for UK
3. ✅ Yahoo Finance bulk metrics sync
4. ✅ Norwegian Brreg API (FREE!)
5. Danish CVR Register API
6. Finnish PRH API
7. German Bundesanzeiger scraper
8. Nasdaq Nordic listed companies sync
9. EU company financial statements scraper

## Status
ACTIVE - Iteration 1 Complete, Ready for Testing
